[platformio]
default_envs = esp32-cyd-sdfix

[env:esp32-cyd]
platform = espressif32@6.6.0
board = esp32dev
framework = arduino

; Put logos/assets in flash filesystem (SPIFFS)
board_build.filesystem = spiffs
board_build.partitions = partitions_spiffs_big.csv

monitor_speed = 115200

; Lock exact toolchain/framework package versions for reproducible builds.
platform_packages =
  framework-arduinoespressif32@3.20014.231204
  tool-esptoolpy@1.40501.0
  toolchain-xtensa-esp32@8.4.0+2021r2-patch5
  tool-mkspiffs@2.230.0
  tool-mklittlefs@1.203.210628
  tool-mkfatfs@2.0.1

lib_deps =
  bodmer/TFT_eSPI@2.5.43
  bblanchon/ArduinoJson@7.4.2
  bitbank2/PNGdec@1.1.6

build_flags =
  -D CORE_DEBUG_LEVEL=0
  -D USER_SETUP_LOADED=1
  -D ST7789_DRIVER=1
  -D TFT_WIDTH=240
  -D TFT_HEIGHT=320
  -D TFT_RGB_ORDER=0
  -D LOAD_GLCD=1
  -D LOAD_FONT2=1
  -D LOAD_FONT4=1
  -D LOAD_FONT6=1
  -D LOAD_FONT7=1
  -D LOAD_FONT8=1
  -D LOAD_GFXFF=1
  -D SMOOTH_FONT=1

  ; CYD TFT pins (ESP32-2432S028 non-R, HSPI)
  -D TFT_MISO=12
  -D TFT_MOSI=13
  -D TFT_SCLK=14
  -D TFT_CS=15
  -D TFT_DC=2
  -D TFT_RST=4
  -D TFT_BL=21
  -D TFT_BACKLIGHT_ON=HIGH
  -D TOUCH_CS=33

  ; Backlight PWM channel
  -D CYD_BL_PWM_CH=0

  ; 27MHz is conservative.
  -D SPI_FREQUENCY=27000000
  -D SPI_READ_FREQUENCY=20000000

[env:esp32-cyd-sdfix]
extends = env:esp32-cyd
upload_speed = 921600
build_flags =
  ${env:esp32-cyd.build_flags}
  -D ENABLE_SD_LOGOS=0



